//contador de los inpus y los text creados
var $inputEdN = 0
var $textN = 0
//array para elementos que ya existian y pueden editarse y su contador
var $arrayText = new Array
var $arrayTextN = -1
var $arrayInput = new Array
var $arrayInputN = -1

$( document ).ready(function() {
  //colocar los text en la view
  <%a = [$arrayTextN,3,4]%>
    console.log("<%= a %>");
  <% @texts.each do |text| %>
    //sumar 1 a los contadores de input y de arrayEditN
    $textN++
    $arrayTextN++
    //recuperar info de la base de datos
    var $element = $('<div id="'+$arrayTextN+'" class="draggableResizable draggabletext" style="position: absolute"/>').append('<label for="text_edit_value"><input id="text-'+$textN+'" type= text value = "<%= text.text%>" name="text_edit_value[text'+$textN+']" />Texto <a class="close" href="#">x</a><input type=text class="hidde-id-edit" value="<%= text.id %>" name="text_edit_ids[text_id_'+$textN +']" /></label>');
    //guardamos el elemento en el arreglo
    $arrayText.push($element);
    console.log($arrayEdit);
    //asignación de posiciones
    $($element).offset({ top: <%=text.y_position%>, left: <%=text.x_position%>});
    //se coloca en la vista
    $("#work_area").append($element);
    //make it "draggable"
    $element.draggable({
      //limitarlo al área de trabajo
      containment: '#work_area',
      //permitirle ajustar su tamaño
    }).resizable();
    //llamamos a la funcion que adapta el tamaño dle input del element
    $('#text-'+$textN+'').on('keyup', resizeInput).each(resizeInput);

  <% end %>
  //colocar los inputs en la view
  <% @inputs.each do |input| %>
    $inputEdN++
    $arrayInputN++
    var $element = $('<div id="'+$arrayInputN+'" class="draggableResizable draggableinput" style="position: absolute"/>').append('<label for="input_edit_value"><input id="input-'+$inputEdN+'" type= text value = "<%= input.answer %>" name="input_edit_value[input'+$inputEdN+']"/>Input <a class="close" href="#">x</a> <input type=text class="hidde-id-edit" value="<%= input.id %>" name="input_edit_ids[input_id_'+$inputEdN +']" /></label>')
    $($element).offset({ top: <%=input.y_position%>, left: <%=input.x_position%>});
    //guardamos el elemento en el arreglo
    $arrayInput.push($element);
    console.log($arrayInput);
    //lo colocamos en la vista
    $("#work_area").append($element);
    //lo hacemos draggable
    $element.draggable({
      //limitarlo al área de trabajo
      containment: '#work_area',
      //permitirle ajustar su tamaño
    }).resizable();
    //llamamos a la funcion que adapta el tamaño dle input del element
    $('#text-'+$textN+'').on('keyup', resizeInput).each(resizeInput);
  <% end %>

  //----> funciones para ambos inputs
  //funcion que permite que los inputs de adapten al contenido
  function resizeInput() {
    var valueLength = $(this).prop('value').length;
    //console.log(valueLength);
    // Para que no arroje error si el input se vacía
    if (valueLength > 0) {

    $(this).prop('size', valueLength);
    }}

    //funcion para eliminar textos del área de trabajo
    $("#work_area").on("click",".close",function(event){
        event.preventDefault();
        var deleted = $(this).parent().parent();
        deleted.remove();
        console.log(deleted.attr("id"));
        //$arrayEdit[deleted.attr("id")] = 0;
        //console.log($arrayEdit);
      });


    //momento de enviar información al controlador
    $(document).on('click','#btn-terminar-ejercicio', function(event) {
      //eliminar los elementos eliminados del arrayEdit
      $arrayText= jQuery.grep($arrayText, function(value) {
        return value != 0;
      });
      $arrayInput= jQuery.grep($arrayInput, function(value) {
          return value != 0;
      });
      <% text_positions=[] %>
      //recorremos los elementos del arrayText para guardar sus posiciones
      for (var positions = 0; positions < $arrayText.length; positions++) {
        //obtener las coordenadas de cada elemento editado
        var $topEdit = $arrayText[positions].offset().top;
        var $leftEdit = $arrayText[positions].offset().left;
        var position = positions + 1
        $("#work_area").append('<label for="exercise_input"><input class="input-hide" type=text value='+ $topEdit +' name="positions_text_ed[input_edit_'+ position +'_top]" /></label>');
        $("#work_area").append('<label for="exercise_input"><input class="input-hide" type=text value='+ $leftEdit +' name="positions_text_ed[input_edit_'+ position +'_left]" /></label>');
      }


    });
});
